<Page
    x:Class="Luo_Painter.DrawPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:transformers="using:FanKit.Transformers"
    xmlns:local="using:Luo_Painter"
    xmlns:controls="using:Luo_Painter.Controls"
    xmlns:elements="using:Luo_Painter.Elements"
    xmlns:layers="using:Luo_Painter.Layers"
    xmlns:menus="using:Luo_Painter.Menus"
    xmlns:tools="using:Luo_Painter.Tools"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    NavigationCacheMode="Required"
    IsEnabled="False"
    mc:Ignorable="d" 
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    >


    <FrameworkElement.Resources>
        <!--Transformer-->
        <transformers:CanvasOperator x:Name="Operator" DestinationControl="{x:Bind Canvas}"/>
        <transformers:CanvasTransformer x:Name="Transformer" />
        <!--Extension-->
        <local:ApplicationBrushesExtension x:Name="ApplicationBrushes"/>
        <!--Range-->
        <local:SizeRange x:Name="SizeRange"/>
        <!--Command-->
        <local:OptionTypeCommand x:Name="Command"/>
    </FrameworkElement.Resources>


    <UIElement.KeyboardAccelerators>
        <KeyboardAccelerator>
            <!--Without it, All controls will show ToolTip for KeyboardAccelerator-->
        </KeyboardAccelerator>

        <local:OptionKeyboardAccelerator Modifiers="Control" Key="S" CommandParameter="Save" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="Z" CommandParameter="Undo" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="Y" CommandParameter="Redo" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator x:Name="FullScreenKey" Modifiers="None" Key="Escape" CommandParameter="FullScreen" Command="{x:Bind Command}" />


        <local:OptionKeyboardAccelerator Modifiers="None" Key="F2" CommandParameter="AddMenuWithRename" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="None" Key="F3" CommandParameter="AddMenu" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="None" Key="F5" CommandParameter="PaintMenu" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="None" Key="F6" CommandParameter="BrushMenu" Command="{x:Bind Command}" />


        <local:OptionKeyboardAccelerator Key="Delete" CommandParameter="Remove" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Key="Insert" CommandParameter="AddLayer" Command="{x:Bind Command}" />

        <local:OptionKeyboardAccelerator Modifiers="Control" Key="X" CommandParameter="Cut" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="J" CommandParameter="Duplicate" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="C" CommandParameter="Copy" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="V" CommandParameter="Paste" Command="{x:Bind Command}" />

        <local:OptionKeyboardAccelerator Key="Back" CommandParameter="Clear" Command="{x:Bind Command}" />

        <local:OptionKeyboardAccelerator Modifiers="Control" Key="E" CommandParameter="Extract" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="M" CommandParameter="Merge" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="F" CommandParameter="Flatten" Command="{x:Bind Command}" />


        <local:OptionKeyboardAccelerator Modifiers="Control" Key="A" CommandParameter="All" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="D" CommandParameter="Deselect" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="I" CommandParameter="MarqueeInvert" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="P" CommandParameter="Pixel" Command="{x:Bind Command}" />


        <local:OptionKeyboardAccelerator Modifiers="Control" Key="R" CommandParameter="Group" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="U" CommandParameter="Ungroup" Command="{x:Bind Command}" />
        <local:OptionKeyboardAccelerator Modifiers="Control" Key="R" CommandParameter="Release" Command="{x:Bind Command}" />
    </UIElement.KeyboardAccelerators>


    <Grid>

        <!--VisualState-->
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>

                <!--Normal-->
                <VisualState x:Name="UnFullScreen">
                    <VisualState.Setters>
                        <Setter Target="HeadTransform.Y" Value="0"/>
                    </VisualState.Setters>
                </VisualState>

                <!--FullScreen-->
                <VisualState x:Name="FullScreen">
                    <VisualState.Setters>
                        <Setter Target="ApplicationView.IsAccent" Value="True"/>

                        <Setter Target="HeadTransform.Y" Value="-50"/>

                        <Setter Target="UnFullScreenButton.Visibility" Value="Visible"/>
                    </VisualState.Setters>
                </VisualState>

                <VisualStateGroup.Transitions>
                    <!--Show-->
                    <VisualTransition From="{x:Null}" To="Show" GeneratedDuration="0:0:0.2">
                        <VisualTransition.GeneratedEasingFunction>
                            <ExponentialEase Exponent="4.5" EasingMode="EaseOut"/>
                        </VisualTransition.GeneratedEasingFunction>
                        <Storyboard>
                            <DoubleAnimation Duration="0:0:0.15" By="{x:Null}" To="0" Storyboard.TargetProperty="Y" Storyboard.TargetName="HeadTransform" d:IsOptimized="True"/>
                        </Storyboard>
                    </VisualTransition>
                    <!--FullScreen-->
                    <VisualTransition From="{x:Null}" To="FullScreen" GeneratedDuration="0:0:0.2">
                        <VisualTransition.GeneratedEasingFunction>
                            <ExponentialEase Exponent="4.5" EasingMode="EaseOut"/>
                        </VisualTransition.GeneratedEasingFunction>
                        <Storyboard>
                            <DoubleAnimation Duration="0:0:0.1" By="{x:Null}" To="-50" Storyboard.TargetProperty="Y" Storyboard.TargetName="HeadTransform" d:IsOptimized="True"/>
                        </Storyboard>
                    </VisualTransition>
                </VisualStateGroup.Transitions>

            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>


        <!--Extension-->
        <elements:ApplicationTitleBarExtension x:Name="ApplicationView" TitleBarColor="{ThemeResource AppBackgroundColorMediumDark}" AccentTitleBarColor="{ThemeResource AppBackgroundColorDark}"/>


        <!--Head-->
        <Button x:Name="UnFullScreenButton" Visibility="Collapsed" HorizontalAlignment="Right" VerticalAlignment="Top" Style="{StaticResource AppButtonStyle}">
            <SymbolIcon Symbol="BackToWindow"/>
        </Button>


        <!--Body-->
        <SplitView 
            x:Name="RightSplitView"
            PanePlacement="Right"
            OpenPaneLength="280"
            IsPaneOpen="True"
            DisplayMode="Inline"
            PaneBackground="{ThemeResource SystemControlAcrylicWindowBrush}"
            >
            <SplitView.Pane>
                <!--Tool-->
                <Grid>

                    <controls:ToolListView x:Name="ToolListView" Visibility="{x:Bind ToolItem.IsSelected, Mode=OneWay}"/>
                    <menus:BrushMenu x:Name="BrushMenu" Visibility="{x:Bind BrushItem.IsSelected, Mode=OneWay}"/>
                    <menus:SizeMenu x:Name="SizeMenu" Visibility="{x:Bind SizeItem.IsSelected, Mode=OneWay}"/>
                    <menus:HistoryMenu x:Name="HistoryMenu" ItemsSource="{x:Bind History.Source}" Visibility="{x:Bind HistoryItem.IsSelected, Mode=OneWay}"/>

                    <Border Height="50" VerticalAlignment="Top" Background="{ThemeResource AppBackgroundMediumLight}">
                        <ListBox x:Name="ToolComboBox" Grid.Column="4" SelectedIndex="0" Margin="2,0" HorizontalAlignment="Center" Style="{StaticResource AppSegmentListBoxStyle}">
                            <ListBoxItem x:Name="ToolItem" MinWidth="32" Width="68">
                                <SymbolIcon Symbol="ViewAll"/>
                            </ListBoxItem>
                            <!--<ListBoxItem x:Name="PaintItem" MinWidth="32" Width="68">
                                <local:ElementIcon Type="Paint"/>
                            </ListBoxItem>-->
                            <ListBoxItem x:Name="BrushItem" MinWidth="32" Width="68">
                                <local:ElementIcon Type="Brush"/>
                            </ListBoxItem>
                            <ListBoxItem x:Name="SizeItem" MinWidth="32" Width="68">
                                <local:ElementIcon Type="Size"/>
                            </ListBoxItem>
                            <ListBoxItem x:Name="HistoryItem">
                                <local:ElementIcon Type="History"/>
                            </ListBoxItem>
                        </ListBox>
                    </Border>
                </Grid>
            </SplitView.Pane>
            <Grid>
                <SplitView 
                    x:Name="LeftSplitView"
                    Margin="0,50,0,0"
                    PanePlacement="Left"      
                    OpenPaneLength="280"    
                    IsPaneOpen="True"    
                    DisplayMode="Inline"  
                    PaneBackground="{ThemeResource SystemControlAcrylicWindowBrush}"   
                    >
                    <SplitView.Pane>
                        <!--Layer-->
                        <controls:LayerListView x:Name="LayerListView" ItemsSource="{x:Bind ObservableCollection}" />
                    </SplitView.Pane>
                    <Grid>

                        <!--Canvas-->
                        <Canvas x:Name="Canvas" Grid.Column="1" Margin="0,50,0,0" FlowDirection="LeftToRight" Background="{ThemeResource AppBackgroundDark}" >
                            <elements:AlignmentGridWithSpot x:Name="AlignmentGrid" IsHitTestVisible="False" />
                            <canvas:CanvasVirtualControl x:Name="CanvasVirtualControl" IsHitTestVisible="False" UseSharedDevice="True" CustomDevice="{x:Bind CanvasDevice}" />
                            <canvas:CanvasAnimatedControl x:Name="CanvasAnimatedControl" IsHitTestVisible="False" TargetElapsedTime="0:0:0.05" UseSharedDevice="True" CustomDevice="{x:Bind CanvasDevice}" />
                            <canvas:CanvasControl x:Name="CanvasControl" UseSharedDevice="True" CustomDevice="{x:Bind CanvasDevice}" />
                        </Canvas>

                        <!--Foot-->
                        <controls:ContextAppBar x:Name="AppBar" Grid.Column="1" />

                        <!--Simulate-->
                        <controls:SimulateCanvas x:Name="SimulateCanvas" Grid.Column="1" Margin="0,50,0,0" />

                    </Grid>
                </SplitView>

                <!--Head-->
                <Grid Height="50" HorizontalAlignment="Stretch" VerticalAlignment="Top" BorderThickness="0,0,0,1" BorderBrush="{ThemeResource AppStroke}" Background="{ThemeResource AppBackgroundMediumLight}">

                    <UIElement.RenderTransformOrigin>
                        0.5,0.5
                    </UIElement.RenderTransformOrigin>
                    <UIElement.RenderTransform>
                        <TranslateTransform x:Name="HeadTransform" Y="0"/>
                    </UIElement.RenderTransform>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="280" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Center" >
                        <Button x:Name="ExportButton" Style="{StaticResource AppTextBlockButtonStyle}">
                            <Border BorderThickness="0,0,0,2" BorderBrush="DodgerBlue" >
                                <SymbolIcon Symbol="NewWindow"/>
                            </Border>
                        </Button>
                        <Button x:Name="LayerButton" Style="{StaticResource AppTextBlockButtonStyle}">
                            <Border BorderThickness="0,0,0,2" BorderBrush="DodgerBlue" >
                                <FontIcon Glyph="&#xF5EE;" FontFamily="Segoe MDL2 Assets"/>
                            </Border>
                        </Button>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" >
                        <Button x:Name="HomeButton" MinWidth="44" Style="{StaticResource AppTextBlockButtonStyle}">
                            <SymbolIcon Symbol="Home"/>
                        </Button>
                        <Button x:Name="UndoButton" IsEnabled="False" MinWidth="44" Style="{StaticResource AppTextBlockButtonStyle}">
                            <SymbolIcon Symbol="Undo"/>
                        </Button>
                        <Button x:Name="RedoButton" IsEnabled="False" MinWidth="44" Style="{StaticResource AppTextBlockButtonStyle}">
                            <SymbolIcon Symbol="Redo"/>
                        </Button>
                        <Button MinWidth="44" Style="{StaticResource AppTextBlockButtonStyle}">
                            <Button.Flyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem x:Name="SaveButton">
                                        <MenuFlyoutItem.Icon>
                                            <SymbolIcon Symbol="Save" Foreground="{StaticResource AppBlueLinearGradientBrush}"/>
                                        </MenuFlyoutItem.Icon>
                                        <MenuFlyoutItem.Text>
                                            Save
                                        </MenuFlyoutItem.Text>
                                    </MenuFlyoutItem>
                                    <MenuFlyoutItem x:Name="KeyButton">
                                        <MenuFlyoutItem.Icon>
                                            <SymbolIcon Symbol="Keyboard" Foreground="{StaticResource AppBlueLinearGradientBrush}"/>
                                        </MenuFlyoutItem.Icon>
                                        <MenuFlyoutItem.Text>
                                            Keyboard Shortcuts
                                        </MenuFlyoutItem.Text>
                                    </MenuFlyoutItem>
                                    <MenuFlyoutItem x:Name="FullScreenButton">
                                        <MenuFlyoutItem.Icon>
                                            <SymbolIcon Symbol="FullScreen" Foreground="{StaticResource AppBlueLinearGradientBrush}"/>
                                        </MenuFlyoutItem.Icon>
                                        <MenuFlyoutItem.Text>
                                            Full Screen
                                        </MenuFlyoutItem.Text>
                                    </MenuFlyoutItem>
                                    <MenuFlyoutItem x:Name="HidePanelButton">
                                        <MenuFlyoutItem.Icon>
                                            <SymbolIcon Symbol="ClosePane" Foreground="{StaticResource AppBlueLinearGradientBrush}"/>
                                        </MenuFlyoutItem.Icon>
                                        <MenuFlyoutItem.Text>
                                            Show Canvas Only
                                        </MenuFlyoutItem.Text>
                                    </MenuFlyoutItem>
                                </MenuFlyout>
                            </Button.Flyout>
                            <SymbolIcon Symbol="More"/>
                        </Button>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Grid.Column="3" HorizontalAlignment="Center" >
                        <Button
                            x:Name="ColorButton"                          
                            Style="{StaticResource AppTextBlockButtonStyle}"                                 
                            ManipulationStarted="{x:Bind ColorMenu.ManipulationStarted2}"                                
                            ManipulationDelta="{x:Bind ColorMenu.ManipulationDelta2}"                                 
                            ManipulationCompleted="{x:Bind ColorMenu.ManipulationCompleted2}"                                 
                            >
                            <UIElement.ManipulationMode>
                                TranslateX, TranslateY
                            </UIElement.ManipulationMode>
                            <Grid>
                                <FontIcon Glyph="&#xE91F;" FontSize="32" FontFamily="Segoe MDL2 Assets" />
                                <Ellipse Width="30" Height="30" VerticalAlignment="Center" HorizontalAlignment="Center" Fill="White" />
                                <Ellipse Width="30" Height="30" VerticalAlignment="Center" HorizontalAlignment="Center" Fill="{x:Bind ColorMenu.Foreground}" />
                            </Grid>
                        </Button>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Center" >
                        <Button x:Name="EditButton" Style="{StaticResource AppButtonStyle}" >
                            <local:ElementIcon Type="Edit"/>
                        </Button>
                        <Button x:Name="AdjustmentButton" Style="{StaticResource AppButtonStyle}" >
                            <local:ElementIcon Type="Adjustment"/>
                        </Button>
                        <Button x:Name="OtherButton" Style="{StaticResource AppButtonStyle}" >
                            <local:ElementIcon Type="Other"/>
                        </Button>
                    </StackPanel>

                </Grid>

            </Grid>
        </SplitView>


        <!--Expander-->
        <Rectangle x:Name="LightDismissOverlay" Visibility="Collapsed" Fill="Transparent"/>
        <elements:ExpanderLightDismissOverlay x:Name="ExpanderLightDismissOverlay" >
            <menus:ExportMenu x:Name="ExportMenu"/>
            <menus:EditMenu x:Name="EditMenu" />
            <menus:AdjustmentMenu x:Name="AdjustmentMenu" />
            <menus:OtherMenu x:Name="OtherMenu" />
            <menus:AddMenu x:Name="AddMenu"/>
            <menus:LayerMenu x:Name="LayerMenu"/>
            <menus:ColorMenu x:Name="ColorMenu" Eyedropper="{x:Bind Eyedropper}" ClickEyedropper="{x:Bind ClickEyedropper}" />
        </elements:ExpanderLightDismissOverlay>


        <!--Tip-->
        <Border IsHitTestVisible="False" CornerRadius="6" Padding="12,3" MinHeight="40" Background="Red" RequestedTheme="Dark" HorizontalAlignment="Center" VerticalAlignment="Center"
                Visibility="{x:Bind ReverseBooleanToVisibilityConverter(AppBar.Selector.IsHitTestVisible), Mode=OneWay}">
            <StackPanel Orientation="Horizontal">
                <SymbolIcon Symbol="Delete"/>
                <ContentControl Width="12"/>
                <TextBlock x:Name="GradientMappingTipTextBlock" FontWeight="Medium" VerticalAlignment="Center">
                    Drop to Remove
                </TextBlock>
            </StackPanel>
        </Border>


        <!--Dialog-->
        <controls:TextureDialog x:Name="TextureDialog" />
        <controls:StretchDialog x:Name="StretchDialog" />


        <!--Tip-->
        <controls:ToastTip x:Name="ToastTip" Visibility="Collapsed" IsHitTestVisible="False" />
        <controls:KeyboardShortcuts x:Name="KeyboardShortcuts" Visibility="Collapsed" />


        <elements:Eyedropper x:Name="Eyedropper" Visibility="Collapsed"/>
        <elements:ClickEyedropper x:Name="ClickEyedropper" Visibility="Collapsed"/>

    </Grid>
</Page>