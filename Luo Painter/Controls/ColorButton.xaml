<Button
    x:Class="Luo_Painter.Controls.ColorButton"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:luo_painter="using:Luo_Painter"
    xmlns:brushes="using:Luo_Painter.Brushes"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    mc:Ignorable="d"
    d:DesignHeight="400"
    d:DesignWidth="400" 
    Width="70" 
    Height="50" 
    Foreground="{ThemeResource AppForeground}" 
    Style="{StaticResource TextBlockButtonStyle}" 
    >

    <UIElement.ManipulationMode>
        TranslateX, TranslateY
    </UIElement.ManipulationMode>

    <FrameworkElement.Resources>
        <!--Transformer-->
        <brushes:InkCanvasOperator x:Name="Operator" DestinationControl="{x:Bind CanvasControl}"/>
    </FrameworkElement.Resources>

    <Button.Flyout>
        <Flyout Placement="Bottom" FlyoutPresenterStyle="{StaticResource AppFlyoutPresenterStyle}">
            <StackPanel Width="320" Height="512" >

                <!--Title-->
                <Grid Padding="6,0" Height="50" BorderThickness="0,0,0,1" BorderBrush="{ThemeResource AppStroke}" >
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="45"/>
                        <ColumnDefinition Width="45"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock                        
                        x:Name="TitleTextBlock"    
                        Margin="10,0"
                        IsHitTestVisible="false"                         
                        FontWeight="Medium"                      
                        TextTrimming="CharacterEllipsis"                      
                        FontSize="20"                     
                        TextWrapping="Wrap"                     
                        VerticalAlignment="Center"                     
                        Style="{StaticResource SubheaderTextBlockStyle}"                    
                        >                      
                        Color
                    </TextBlock>
                    <Button x:Name="StrawButton" Grid.Column="1" Width="70" Height="50" Foreground="{ThemeResource AppForeground}" Style="{StaticResource TextBlockButtonStyle}" >
                        <UIElement.ManipulationMode>
                            TranslateX, TranslateY
                        </UIElement.ManipulationMode>
                        <FontIcon Glyph="&#xEF3C;" FontFamily="Segoe MDL2 Assets" />
                    </Button>
                    <Border Grid.Column="2" CornerRadius="6,0,0,6" Width="45" Height="32" >
                        <Border.Background>
                            <SolidColorBrush Color="{x:Bind ColorPicker.Color, Mode=OneWay}" />
                        </Border.Background>
                    </Border>
                    <Border Grid.Column="3" CornerRadius="0,6,6,0" Width="45" Height="32" >
                        <Border.Background>
                            <SolidColorBrush x:Name="SolidColorBrush" Color="Black"/>
                        </Border.Background>
                    </Border>
                </Grid>

                <!--Type-->
                <ListBox x:Name="ComboBox" Margin="6" SelectedIndex="0" >
                    <ListBoxItem Width="51" HorizontalContentAlignment="Center">
                        <ToolTipService.ToolTip>
                            <ToolTip x:Name="BoxHueToolTip">
                                Hue
                            </ToolTip>
                        </ToolTipService.ToolTip>
                        <luo_painter:ElementIcon Type="ColorBoxHue"/>
                    </ListBoxItem>
                    <ListBoxItem Width="51" HorizontalContentAlignment="Center">
                        <ToolTipService.ToolTip>
                            <ToolTip x:Name="BoxSaturationToolTip">
                                Saturation
                            </ToolTip>
                        </ToolTipService.ToolTip>
                        <luo_painter:ElementIcon Type="ColorBoxSaturation"/>
                    </ListBoxItem>
                    <ListBoxItem Width="51" HorizontalContentAlignment="Center">
                        <ToolTipService.ToolTip>
                            <ToolTip x:Name="BoxValueToolTip">
                                Value
                            </ToolTip>
                        </ToolTipService.ToolTip>
                        <luo_painter:ElementIcon Type="ColorBoxValue"/>
                    </ListBoxItem>

                    <ListBoxItem Width="51" HorizontalContentAlignment="Center">
                        <ToolTipService.ToolTip>
                            <ToolTip x:Name="RingSaturationToolTip">
                                Saturation
                            </ToolTip>
                        </ToolTipService.ToolTip>
                        <luo_painter:ElementIcon Type="ColorRingSaturation"/>
                    </ListBoxItem>
                    <ListBoxItem Width="51" HorizontalContentAlignment="Center">
                        <ToolTipService.ToolTip>
                            <ToolTip x:Name="RingValueToolTip">
                                Value
                            </ToolTip>
                        </ToolTipService.ToolTip>
                        <luo_painter:ElementIcon Type="ColorRingValue"/>
                    </ListBoxItem>

                    <ListBoxItem Width="51" HorizontalContentAlignment="Center">
                        <ToolTipService.ToolTip>
                            <ToolTip x:Name="PaletteItemToolTip">
                                Palette
                            </ToolTip>
                        </ToolTipService.ToolTip>
                        <luo_painter:ElementIcon Type="ColorPalette"/>
                    </ListBoxItem>
                </ListBox>

                <!--Color-->
                <ColorPicker
                    x:Name="ColorPicker" 
                    Width="320"
                    Height="358"
                    Color="Black" 
                    IsMoreButtonVisible="False" 
                    IsHexInputVisible="False" 
                    IsColorSpectrumVisible="True" 
                    IsColorSliderVisible="True" 
                    IsColorPreviewVisible="False" 
                    IsColorChannelTextInputVisible="False" 
                    IsAlphaTextInputVisible="False" 
                    IsAlphaSliderVisible="False" 
                    IsAlphaEnabled="False" 
                    ColorSpectrumShape="{x:Bind ColorSpectrumShapeConverter(ComboBox.SelectedIndex),Mode=OneWay}" 
                    ColorSpectrumComponents="{x:Bind ColorSpectrumComponentsConverter(ComboBox.SelectedIndex),Mode=OneWay}" 
                    Visibility="{x:Bind ColorVisibilityConverter(ComboBox.SelectedIndex),Mode=OneWay}" 
                    />

                <!--Swatches-->
                <ListView 
                    x:Name="ListView"
                    Margin="8,11"
                    Padding="0"
                    Height="28"
                    IsItemClickEnabled="True"
                    SelectionMode="None" 
                    Background="{ThemeResource AppBackground}"
                    ItemsSource="{x:Bind ObservableCollection}"          
                    Visibility="{x:Bind ColorVisibilityConverter(ComboBox.SelectedIndex),Mode=OneWay}" 
                    ScrollViewer.HorizontalScrollMode="Enabled"
                    ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                    ScrollViewer.VerticalScrollMode="Disabled"
                    ScrollViewer.VerticalScrollBarVisibility="Disabled"
                    >

                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="Width" Value="28"/>
                            <Setter Property="MinWidth" Value="28"/>
                            <Setter Property="Height" Value="28"/>
                            <Setter Property="MinHeight" Value="28"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                        </Style>
                    </ItemsControl.ItemContainerStyle>

                    <ItemsControl.ItemContainerTransitions>
                        <TransitionCollection>

                        </TransitionCollection>
                    </ItemsControl.ItemContainerTransitions>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Rectangle Width="28" Height="28" >
                                <Shape.Fill>
                                    <SolidColorBrush Color="{Binding}"/>
                                </Shape.Fill>
                            </Rectangle>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>

                </ListView>

                <!--Palette-->
                <canvas:CanvasControl 
                    x:Name="CanvasControl" 
                    Width="320"
                    Height="358"
                    ClearColor="White" 
                    UseSharedDevice="True" 
                    CustomDevice="{x:Bind CanvasDevice}" 
                    Visibility="{x:Bind PaletteVisibilityConverter(ComboBox.SelectedIndex),Mode=OneWay}" 
                    />

                <!--Tool-->
                <Grid Padding="6,0" Height="50" Visibility="{x:Bind PaletteVisibilityConverter(ComboBox.SelectedIndex),Mode=OneWay}" >
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!--Tool-->
                    <ListBox x:Name="ToolComboBox" SelectedIndex="0" VerticalAlignment="Center" Style="{StaticResource AppSegmentListBoxStyle}">
                        <ListBoxItem x:Name="PaintItem">Paint</ListBoxItem>
                        <ListBoxItem x:Name="StrawItem">Straw</ListBoxItem>
                    </ListBox>

                    <Button x:Name="ImageButton" Grid.Column="1" Width="70" Height="50" Foreground="{ThemeResource AppForeground}" Style="{StaticResource TextBlockButtonStyle}" >
                        <SymbolIcon Symbol="Pictures"/>
                    </Button>

                    <Button x:Name="ClearButton" Grid.Column="2" Width="70" Height="50" Foreground="{ThemeResource AppForeground}" Style="{StaticResource TextBlockButtonStyle}" >
                        <SymbolIcon Symbol="Delete"/>
                    </Button>
                </Grid>

            </StackPanel>
        </Flyout>
    </Button.Flyout>

    <Grid>
        <FontIcon Glyph="&#xE91F;" FontSize="32" FontFamily="Segoe MDL2 Assets" />
        <Ellipse Width="30" Height="30" VerticalAlignment="Center" HorizontalAlignment="Center" Fill="White" />
        <Ellipse Width="30" Height="30" VerticalAlignment="Center" HorizontalAlignment="Center" >
            <Shape.Fill>
                <SolidColorBrush Color="{x:Bind ColorPicker.Color, Mode=OneWay}" />
            </Shape.Fill>
        </Ellipse>
    </Grid>

</Button>