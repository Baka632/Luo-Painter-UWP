<Button
    x:Class="Luo_Painter.Controls.ColorButton"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:brushes="using:Luo_Painter.Brushes"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    mc:Ignorable="d"
    d:DesignHeight="400"
    d:DesignWidth="400" 
    Width="70" 
    Height="50" 
    Foreground="{ThemeResource AppForeground}" 
    Style="{StaticResource TextBlockButtonStyle}" 
    >

    <UIElement.ManipulationMode>
        TranslateX, TranslateY
    </UIElement.ManipulationMode>

    <FrameworkElement.Resources>
        <!--Transformer-->
        <brushes:InkCanvasOperator x:Name="Operator" DestinationControl="{x:Bind CanvasControl}"/>
    </FrameworkElement.Resources>

    <Button.Flyout>
        <Flyout Placement="Bottom" FlyoutPresenterStyle="{StaticResource AppFlyoutPresenterStyle}">
            <StackPanel Width="320" >

                <!--Title-->
                <Grid Padding="6,0" Height="50" BorderThickness="0,0,0,1" BorderBrush="{ThemeResource AppStroke}" >
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="45"/>
                        <ColumnDefinition Width="45"/>
                    </Grid.ColumnDefinitions>
                    
                    <ComboBox SelectedIndex="0" HorizontalAlignment="Left">
                        <ComboBoxItem x:Name="ColorItem">
                            <TextBlock                                
                                x:Name="ColorTitleTextBlock"      
                                IsHitTestVisible="false"                                 
                                FontWeight="Medium"                      
                                TextTrimming="CharacterEllipsis"                      
                                FontSize="20"                     
                                TextWrapping="Wrap"                     
                                VerticalAlignment="Center"                     
                                Style="{StaticResource SubheaderTextBlockStyle}"                    
                                >                      
                                Color
                            </TextBlock>
                        </ComboBoxItem>
                        <ComboBoxItem x:Name="PaletteItem">
                            <TextBlock                                
                                x:Name="PaletteTitleTextBlock"      
                                IsHitTestVisible="false"                                 
                                FontWeight="Medium"                      
                                TextTrimming="CharacterEllipsis"                      
                                FontSize="20"                     
                                TextWrapping="Wrap"                     
                                VerticalAlignment="Center"                     
                                Style="{StaticResource SubheaderTextBlockStyle}"                    
                                >                      
                                Palette
                            </TextBlock>
                        </ComboBoxItem>
                    </ComboBox>

                    <Button x:Name="StrawButton" Grid.Column="1" Width="70" Height="50" Foreground="{ThemeResource AppForeground}" Style="{StaticResource TextBlockButtonStyle}" >
                        <UIElement.ManipulationMode>
                            TranslateX, TranslateY
                        </UIElement.ManipulationMode>
                        <FontIcon Glyph="&#xEF3C;" FontFamily="Segoe MDL2 Assets" />
                    </Button>
                    <Border Grid.Column="2" CornerRadius="6,0,0,6" Width="45" Height="32" >
                        <Border.Background>
                            <SolidColorBrush Color="{x:Bind ColorPicker.Color, Mode=OneWay}" />
                        </Border.Background>
                    </Border>
                    <Border Grid.Column="3" CornerRadius="0,6,6,0" Width="45" Height="32" >
                        <Border.Background>
                            <SolidColorBrush x:Name="SolidColorBrush" Color="Black"/>
                        </Border.Background>
                    </Border>
                </Grid>

                <!--Type-->
                <Grid ColumnSpacing="8" Padding="6,0" Height="50" Visibility="{x:Bind ColorItem.IsSelected, Mode=OneWay}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>

                    <!--Components-->
                    <ComboBox x:Name="ComponentsComboBox" SelectedIndex="0" >
                        <ComboBoxItem x:Name="SaturationValueItem">SaturationValue</ComboBoxItem>
                        <ComboBoxItem x:Name="HueSaturationItem">HueSaturation</ComboBoxItem>
                        <ComboBoxItem x:Name="HueValueItem">HueValue</ComboBoxItem>
                    </ComboBox>

                    <!--Shape-->
                    <ComboBox x:Name="ShapeComboBox" Grid.Column="1" SelectedIndex="0" >
                        <ComboBoxItem x:Name="BoxItem">Box</ComboBoxItem>
                        <ComboBoxItem x:Name="RingItem">Ring</ComboBoxItem>
                    </ComboBox>

                </Grid>

                <!--Color-->
                <ColorPicker
                    x:Name="ColorPicker" 
                    Width="320"
                    Height="358"
                    Color="Black" 
                    IsMoreButtonVisible="False" 
                    IsHexInputVisible="False" 
                    IsColorSpectrumVisible="True" 
                    IsColorSliderVisible="True" 
                    IsColorPreviewVisible="False" 
                    IsColorChannelTextInputVisible="False" 
                    IsAlphaTextInputVisible="False" 
                    IsAlphaSliderVisible="False" 
                    IsAlphaEnabled="False" 
                    ColorSpectrumShape="{x:Bind ColorSpectrumShapeConverter(ShapeComboBox.SelectedIndex),Mode=OneWay}" 
                    ColorSpectrumComponents="{x:Bind ColorSpectrumComponentsConverter(ComponentsComboBox.SelectedIndex),Mode=OneWay}" 
                    Visibility="{x:Bind ColorItem.IsSelected, Mode=OneWay}"
                    />

                <!--Swatches-->
                <ListView 
                    x:Name="ListView"
                    Margin="0,6"
                    IsItemClickEnabled="True"
                    SelectionMode="None" 
                    ItemsSource="{x:Bind ObservableCollection}"          
                    Visibility="{x:Bind ColorItem.IsSelected, Mode=OneWay}"
                    >

                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Margin="8,0" Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="1"/>
                            <Setter Property="Width" Value="42"/>
                            <Setter Property="MinWidth" Value="42"/>
                            <Setter Property="Height" Value="42"/>
                            <Setter Property="MinHeight" Value="42"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                        </Style>
                    </ItemsControl.ItemContainerStyle>

                    <ItemsControl.ItemContainerTransitions>
                        <TransitionCollection>

                        </TransitionCollection>
                    </ItemsControl.ItemContainerTransitions>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Rectangle RadiusX="4" RadiusY="4" Width="36" Height="36" StrokeThickness="1" Stroke="White" >
                                <Shape.Fill>
                                    <SolidColorBrush Color="{Binding}"/>
                                </Shape.Fill>
                            </Rectangle>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>

                </ListView>

                <!--Tool-->
                <Grid Padding="6,0" Height="50" Visibility="{x:Bind PaletteItem.IsSelected, Mode=OneWay}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!--Tool-->
                    <ComboBox x:Name="ToolComboBox" SelectedIndex="0" >
                        <ComboBoxItem x:Name="PaintItem">Paint</ComboBoxItem>
                        <ComboBoxItem x:Name="StrawItem">Straw</ComboBoxItem>
                    </ComboBox>

                    <Button x:Name="ImageButton" Grid.Column="1" Width="70" Height="50" Foreground="{ThemeResource AppForeground}" Style="{StaticResource TextBlockButtonStyle}" >
                        <SymbolIcon Symbol="Pictures"/>
                    </Button>

                    <Button x:Name="ClearButton" Grid.Column="2" Width="70" Height="50" Foreground="{ThemeResource AppForeground}" Style="{StaticResource TextBlockButtonStyle}" >
                        <SymbolIcon Symbol="Delete"/>
                    </Button>
                </Grid>
                
                <!--Palette-->
                <canvas:CanvasControl 
                    x:Name="CanvasControl" 
                    Width="320"
                    Height="408"
                    ClearColor="White" 
                    UseSharedDevice="True" 
                    CustomDevice="{x:Bind CanvasDevice}" 
                    Visibility="{x:Bind PaletteItem.IsSelected, Mode=OneWay}"
                    />

            </StackPanel>
        </Flyout>
    </Button.Flyout>

    <Grid>
        <FontIcon Glyph="&#xE91F;" FontSize="32" FontFamily="Segoe MDL2 Assets" />
        <Ellipse Width="30" Height="30" VerticalAlignment="Center" HorizontalAlignment="Center" Fill="White" />
        <Ellipse Width="30" Height="30" VerticalAlignment="Center" HorizontalAlignment="Center" >
            <Shape.Fill>
                <SolidColorBrush Color="{x:Bind ColorPicker.Color, Mode=OneWay}" />
            </Shape.Fill>
        </Ellipse>
    </Grid>

</Button>